import taskFactory from "./factories/taskFactory";
import { Status } from "../enums/status";
import { getCurrentProject } from "./project";
import { renderProjectPage, clearPage } from "../../pages/display.js";

/* Create a new task and adds to a project */
function createTask(project, title, description, dueDate, priority) {
    const projectID = project.getProjectID();
    const taskID = project.getNextTaskCount();
    const newTask = taskFactory(title, description, dueDate, priority, projectID, taskID);

    project.addTask(newTask);
}

/* Edit an existing task */
function editTask(task, title, description, dueDate, priority, status) {
    task.setTitle(title);
    task.setDescription(task, description);
    task.setDueDate(task, dueDate);
    task.setPriority(task, priority);
    task.setStatus(task, status);
}

// /* Delete an exisiting task */
// function deleteTask(task) {
//     delete task.getTitle();
//     delete task.getDescription();
//     delete task.getDueDate();
//     delete task.getPriority();
//     delete task.getStatus();
// }

/* Creates a task from creation form */
function createTaskFromForm() {
    const title = document.querySelector("#task-title").value;
    const desc = document.querySelector("#task-desc").value;
    const date = document.querySelector("#task-date").value;
    const priority = document.querySelector('input[name="priority"]:checked').value;

    createTask(getCurrentProject(), title, desc, date, priority);
    clearPage();
    renderProjectPage(getCurrentProject());
}

/* Edits a task based on information in edit form */
function editTaskFromForm(task) {
    const newTitle = document.querySelector("#task-title").value;
    const newDesc = document.querySelector("#task-desc").value;
    const newDate = document.querySelector("#task-date").value;
    const newPriority = document.querySelector("input[name='priority']:checked").value;

    task.setTitle(newTitle);
    task.setDescription(newDesc);
    task.setDueDate(newDate);
    task.setPriority(newPriority);
}

/* Complete a task and convert all steps to required status*/
function completeTask(task) {
    // Mark incomplete steps
    task.setStatus(Status.COMPLETED);
    task.getTodoSteps().array.forEach(step => {
        step.setIncomplete();
    });
}

export { createTask, editTask, completeTask, createTaskFromForm, editTaskFromForm }